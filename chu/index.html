<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chu Checker</title>
  <meta name="description" content="Chu Checker - counter and timer tracking page." />
  <style>
    :root {
      color-scheme: dark;
      --bg: #121212;
      --card: #1e1e1e;
      --text: #e0e0e0;
      --border: #2a2a2a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, Helvetica, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container { width: min(680px, 96vw); background: var(--card); padding: 20px; border-radius: 10px; border: 1px solid var(--border); }
    .button-group { display: flex; justify-content: space-between; gap: 10px; }
    .count-button { flex: 1; height: 84px; border: none; border-radius: 50px; color: #fff; position: relative; display: flex; align-items: center; justify-content: center; flex-direction: column; cursor: pointer; }
    .count-button .count { font-size: 22px; }
    .count-button.red { background: #e53935; }
    .count-button.green { background: #43a047; }
    .count-button.blue { background: #1e88e5; }
    .count-button .edit-btn { position: absolute; top: 8px; right: 10px; cursor: pointer; }
    .time-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-top: 16px; }
    .time-box { flex: 1; background: #101010; border: 1px solid var(--border); padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    .time-toggle { border: none; border-radius: 20px; width: 38px; height: 38px; color: #fff; background: #424242; cursor: pointer; }
    .time-toggle.active { background: #039be5; }
    .total { margin-top: 12px; color: #b0bec5; font-size: 14px; }
    .reset-button { margin-top: 16px; width: 100%; height: 40px; border: none; border-radius: 6px; background: #e53935; color: #fff; cursor: pointer; }

    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,.6);
      display: none; align-items: center; justify-content: center;
    }
    .modal-content { width: min(360px, 90vw); background: #242424; border: 1px solid #555; border-radius: 10px; padding: 16px; }
    .modal-content input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #555; background: #121212; color: #fff; }
    .modal-actions { margin-top: 10px; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-actions button { padding: 8px 12px; border: none; border-radius: 6px; color: white; cursor: pointer; }
    .save-button { background: #43a047; }
    .cancel-button { background: #616161; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Chu Checker</h2>
    <div class="button-group">
      <button class="count-button red" data-key="red">
        <span id="label-red">Red</span>
        <span class="count" id="count-red">0</span>
        <span class="edit-btn" data-edit="label-red">✎</span>
      </button>
      <button class="count-button green" data-key="green">
        <span id="label-green">Green</span>
        <span class="count" id="count-green">0</span>
        <span class="edit-btn" data-edit="label-green">✎</span>
      </button>
      <button class="count-button blue" data-key="blue">
        <span id="label-blue">Blue</span>
        <span class="count" id="count-blue">0</span>
        <span class="edit-btn" data-edit="label-blue">✎</span>
      </button>
    </div>

    <div class="time-row">
      <div class="time-box">
        <span id="time-label-1">Time 1</span>
        <button class="time-toggle" data-index="0">▶</button>
      </div>
      <div class="time-box">
        <span id="time-display-1">0.0s</span>
        <span class="edit-btn" data-edit="time-label-1">✎</span>
      </div>
    </div>

    <div class="time-row">
      <div class="time-box">
        <span id="time-label-2">Time 2</span>
        <button class="time-toggle" data-index="1">▶</button>
      </div>
      <div class="time-box">
        <span id="time-display-2">0.0s</span>
        <span class="edit-btn" data-edit="time-label-2">✎</span>
      </div>
    </div>

    <div class="total">Total: <span id="total-time">0.0</span>s</div>

    <button id="reset" class="reset-button">Reset all</button>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Edit text</h3>
      <input id="edit-input" maxlength="50" />
      <div class="modal-actions">
        <button class="cancel-button" id="cancel-button">Cancel</button>
        <button class="save-button" id="save-button">Save</button>
      </div>
    </div>
  </div>

  <script>
    const state = {
      counts: { red: 0, green: 0, blue: 0 },
      labels: {
        red: 'Red',
        green: 'Green',
        blue: 'Blue',
        'time-label-1': 'Time 1',
        'time-label-2': 'Time 2',
      },
      times: [0, 0],
      running: [false, false],
      startAt: [0, 0],
      intervals: [null, null],
    };

    const STORAGE_KEY = 'chuData_v3';
    let editingTarget = null;

    function formatTime(v) { return `${v.toFixed(1)}s`; }

    function render() {
      document.getElementById('count-red').textContent = state.counts.red;
      document.getElementById('count-green').textContent = state.counts.green;
      document.getElementById('count-blue').textContent = state.counts.blue;

      document.getElementById('label-red').textContent = state.labels.red;
      document.getElementById('label-green').textContent = state.labels.green;
      document.getElementById('label-blue').textContent = state.labels.blue;

      document.getElementById('time-label-1').textContent = state.labels['time-label-1'];
      document.getElementById('time-label-2').textContent = state.labels['time-label-2'];
      document.getElementById('time-display-1').textContent = formatTime(state.times[0]);
      document.getElementById('time-display-2').textContent = formatTime(state.times[1]);

      const total = state.times.reduce((a, b) => a + b, 0);
      document.getElementById('total-time').textContent = total.toFixed(1);
    }

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
        const parsed = JSON.parse(raw);
        state.counts = parsed.counts || state.counts;
        state.labels = parsed.labels || state.labels;
        state.times = parsed.times || state.times;
      } catch {}
      render();
    }

    function toggleTimer(index) {
      const button = document.querySelector(`.time-toggle[data-index="${index}"]`);
      const isRunning = state.running[index];
      if (!isRunning) {
        state.running[index] = true;
        state.startAt[index] = Date.now();
        button.classList.add('active');
        state.intervals[index] = setInterval(() => {
          const delta = (Date.now() - state.startAt[index]) / 1000;
          state.times[index] = (delta >= 0 ? delta : state.times[index]);
          render();
          save();
        }, 100);
      } else {
        state.running[index] = false;
        if (state.intervals[index]) {
          clearInterval(state.intervals[index]);
          state.intervals[index] = null;
        }
        state.times[index] = Number(state.times[index].toFixed(1));
        button.classList.remove('active');
        state.startAt[index] = Date.now();
      }
      button.textContent = state.running[index] ? '⏸' : '▶';
      render();
      save();
    }

    function resetAll() {
      if (!confirm('Reset all counters and times?')) return;
      state.counts = { red: 0, green: 0, blue: 0 };
      state.labels = {
        red: 'Red',
        green: 'Green',
        blue: 'Blue',
        'time-label-1': 'Time 1',
        'time-label-2': 'Time 2',
      };
      state.times = [0, 0];
      state.running = [false, false];
      state.startAt = [0, 0];
      state.intervals.forEach(i => i && clearInterval(i));
      state.intervals = [null, null];
      document.querySelectorAll('.time-toggle').forEach(btn => {
        btn.classList.remove('active');
        btn.textContent = '▶';
      });
      localStorage.removeItem(STORAGE_KEY);
      save();
      render();
    }

    // count buttons
    document.querySelectorAll('.count-button').forEach(button => {
      const key = button.dataset.key;
      button.addEventListener('click', (e) => {
        if (e.target.closest('.edit-btn')) return;
        state.counts[key] += 1;
        save();
        render();
      });
    });

    // edit icon
    document.querySelectorAll('.edit-btn').forEach(icon => {
      icon.addEventListener('click', (e) => {
        editingTarget = e.target.getAttribute('data-edit');
        document.getElementById('edit-input').value = state.labels[editingTarget];
        document.getElementById('modal').style.display = 'flex';
      });
    });

    // time timer toggles
    document.querySelectorAll('.time-toggle').forEach(btn => {
      const idx = Number(btn.dataset.index);
      btn.addEventListener('click', () => toggleTimer(idx));
    });

    document.getElementById('save-button').addEventListener('click', () => {
      if (!editingTarget) return;
      const value = document.getElementById('edit-input').value.trim() || 'Untitled';
      state.labels[editingTarget] = value;
      editingTarget = null;
      document.getElementById('modal').style.display = 'none';
      save();
      render();
    });

    document.getElementById('cancel-button').addEventListener('click', () => {
      editingTarget = null;
      document.getElementById('modal').style.display = 'none';
    });

    document.getElementById('reset').addEventListener('click', resetAll);

    load();
    render();
  </script>
</body>
</html>
