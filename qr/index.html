<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator and Scanner</title>
    <meta name="description" content="Generate and scan QR codes instantly. Supports URLs, text, contact info, and WiFi credentials. Works on all devices.">
    <meta name="keywords" content="QR code generator, QR code scanner, online QR tools, mobile QR generator">
    <meta name="author" content="cocy.io">
    <meta property="og:title" content="Online QR Code Generator and Scanner">
    <meta property="og:description" content="Free web-based QR code generation and scanning tool with real-time preview">
    <meta property="og:image" content="https://tool.cocy.io/qr/icon.svg">
    <meta property="og:url" content="https://tool.cocy.io/qr/">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Localization Script -->
    <script src="https://tool.cocy.io/localization.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KLF3L6R84V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KLF3L6R84V');
    </script>
    
    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script type="module" src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #121212 0%, #1a1a1a 100%);
            color: #f0f0f0;
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body.light-mode {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #212529;
        }
        
        .container {
            background: rgba(34, 34, 34, 0.95);
            border: 1px solid #333333;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            max-width: 800px;
            margin: 2rem auto;
            padding: 25px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        body.light-mode .container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e0e0e0;
            color: #212529;
        }
        
        .qr-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        body.dark-mode .qr-section {
            background: rgba(40, 40, 40, 0.95);
            color: #f0f0f0;
        }
        
        #qrcode {
            margin: 1.5rem auto;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 8px;
            padding: 10px;
        }
        
        body.dark-mode #qrcode {
            background: #f8f9fa;
        }
        
        #video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }
        
        #qr-video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .highlight-box {
            position: absolute;
            border: 2px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            display: none;
        }
        
        .btn-primary {
            background: #4285f4;
            border-color: #4285f4;
            font-weight: 500;
        }
        
        .btn-success {
            background: #34a853;
            border-color: #34a853;
            font-weight: 500;
        }
        
        .btn-danger {
            background: #ea4335;
            border-color: #ea4335;
            font-weight: 500;
        }
        
        .btn {
            border-radius: 8px;
            padding: 10px 16px;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .qr-section h2 {
            color: #333;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
            margin-bottom: 1rem;
            font-weight: 700;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        body.dark-mode .qr-section h2 {
            color: #f0f0f0;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }
        
        .alert {
            border-radius: 8px;
            font-weight: 500;
        }
        
        #scanResult {
            word-break: break-all;
        }
        
        .camera-controls {
            margin-bottom: 1rem;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-scanning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            .container {
                margin: 1rem auto;
                padding: 15px;
                width: 95%;
            }
            .qr-section {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            .camera-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 12px;
                border-radius: 12px;
            }
            .qr-section {
                padding: 1.2rem;
            }
        }

        .nav-tabs {
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tabs .nav-link {
            color: #6c757d;
            border: 1px solid transparent;
            border-top-left-radius: 0.25rem;
            border-top-right-radius: 0.25rem;
            padding: 0.5rem 1rem;
            margin-bottom: -1px;
        }

        .nav-tabs .nav-link:hover {
            border-color: #e9ecef #e9ecef #dee2e6;
        }

        .nav-tabs .nav-link.active {
            color: #495057;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
        }

        body.dark-mode .nav-tabs .nav-link {
            color: #adb5bd;
        }

        body.dark-mode .nav-tabs .nav-link.active {
            color: #f8f9fa;
            background-color: #343a40;
            border-color: #495057 #495057 #343a40;
        }

        body.dark-mode .nav-tabs {
            border-bottom-color: #495057;
        }

        .wifi-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .wifi-info p {
            margin-bottom: 8px;
        }

        .wifi-info p:last-child {
            margin-bottom: 0;
        }

        body.dark-mode .wifi-info {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-center display-4 flex-grow-1" data-translate-key="qr_title">QR Code Generator and Scanner</h1>
            <button id="themeToggle" class="btn btn-outline-secondary" onclick="toggleTheme()">
                <span id="themeIcon">ğŸŒ</span>
            </button>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ì¶”ê°€ -->
        <div class="nav nav-tabs mb-4" id="qrTabs" role="tablist">
            <button class="nav-link active" id="generate-tab" data-bs-toggle="tab" data-bs-target="#generate" type="button" role="tab">QR ìƒì„±</button>
            <button class="nav-link" id="wifi-tab" data-bs-toggle="tab" data-bs-target="#wifi" type="button" role="tab">WiFi QR</button>
            <button class="nav-link" id="scan-tab" data-bs-toggle="tab" data-bs-target="#scan" type="button" role="tab">QR ìŠ¤ìº”</button>
        </div>

        <!-- íƒ­ ì½˜í…ì¸  -->
        <div class="tab-content" id="qrTabContent">
            <!-- QR ìƒì„± íƒ­ -->
            <div class="tab-pane fade show active" id="generate" role="tabpanel">
                <div class="qr-section">
                    <h2>QR ì½”ë“œ ìƒì„±</h2>
                    <div class="input-group mb-3">
                        <input type="text" id="qrText" class="form-control" placeholder="í…ìŠ¤íŠ¸ ë˜ëŠ” URLì„ ì…ë ¥í•˜ì„¸ìš”">
                        <button onclick="generateQR()" class="btn btn-primary">ìƒì„±í•˜ê¸°</button>
                    </div>
                    <div id="qrcode"></div>
                    <div class="mt-3">
                        <button id="downloadBtn" class="btn btn-outline-primary" style="display:none;">QR ì½”ë“œ ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
            </div>

            <!-- WiFi QR íƒ­ -->
            <div class="tab-pane fade" id="wifi" role="tabpanel">
                <div class="qr-section">
                    <h2>WiFi QR ì½”ë“œ ìƒì„±</h2>
                    <form id="wifiForm" class="mb-3">
                        <div class="mb-3">
                            <label for="ssid" class="form-label">ë„¤íŠ¸ì›Œí¬ ì´ë¦„ (SSID)</label>
                            <input type="text" class="form-control" id="ssid" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="encryption" class="form-label">ì•”í˜¸í™” ë°©ì‹</label>
                            <select class="form-select" id="encryption">
                                <option value="WPA">WPA/WPA2</option>
                                <option value="WEP">WEP</option>
                                <option value="nopass">ì•”í˜¸í™” ì—†ìŒ</option>
                            </select>
                        </div>
                        <button type="button" onclick="generateWifiQR()" class="btn btn-primary">WiFi QR ìƒì„±</button>
                    </form>
                    <div id="wifiQrcode"></div>
                    <div class="mt-3">
                        <button id="wifiDownloadBtn" class="btn btn-outline-primary" style="display:none;">WiFi QR ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
            </div>

            <!-- QR ìŠ¤ìº” íƒ­ -->
            <div class="tab-pane fade" id="scan" role="tabpanel">
                <div class="qr-section">
                    <h2>QR ì½”ë“œ ìŠ¤ìº”</h2>
                    <!-- ê¸°ì¡´ ìŠ¤ìº” ê´€ë ¨ ì½”ë“œ ìœ ì§€ -->
                    <div class="camera-controls">
                        <select id="cameraSelect" class="form-select flex-grow-1">
                            <option value="">ì¹´ë©”ë¼ ì„ íƒ</option>
                        </select>
                        <span id="statusIndicator" class="status-indicator status-ready">ì¤€ë¹„ë¨</span>
                    </div>
                    
                    <div class="mb-3">
                        <div class="mb-3">
                            <label for="qrImageUpload" class="form-label">ğŸ“ QR ì½”ë“œ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                            <input type="file" id="qrImageUpload" class="form-control" accept="image/*" onchange="scanFromImage()">
                        </div>
                        
                        <div id="video-container" style="display: none;">
                            <video id="qr-video" playsinline></video>
                            <div id="highlight-box" class="highlight-box"></div>
                        </div>
                        <div id="scan-placeholder" class="text-center p-5 bg-light rounded">
                            ğŸ“· ìŠ¤ìº” ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´ë©”ë¼ë¥¼ í™œì„±í™”í•˜ê±°ë‚˜ ìœ„ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”
                        </div>
                    </div>
                    
                    <div id="scanResult" class="alert alert-info" style="display:none;">
                        <strong>ìŠ¤ìº” ê²°ê³¼:</strong> <span id="resultText"></span>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="copyResult()">ğŸ“‹ ë³µì‚¬</button>
                            <button class="btn btn-sm btn-outline-success" onclick="openResult()" id="openBtn" style="display:none;">ğŸŒ ì—´ê¸°</button>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button onclick="toggleScanner()" id="scanBtn" class="btn btn-success">ğŸ“· ìŠ¤ìº” ì‹œì‘</button>
                        <button onclick="stopScanner()" id="stopBtn" class="btn btn-danger" style="display:none;">â¹ï¸ ìŠ¤ìº” ì¤‘ì§€</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 mt-5">
        <div class="container">
            <p class="mb-1">Powered by <a href="https://cocy.io" target="_blank">cocy.io</a></p>
            <p class="small text-muted">Free QR Code Generator and Scanner Tool</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        import QrScanner from 'https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js';
        
        // Global variables
        let qrScanner = null;
        let scannerActive = false;
        let lastResult = '';
        
        // Set worker path
        QrScanner.WORKER_PATH = 'https://unpkg.com/qr-scanner@1.4.2/qr-scanner-worker.min.js';
        
        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                themeIcon.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeIcon.textContent = 'ğŸŒ';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'light') {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                themeIcon.textContent = 'ğŸŒ™';
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeIcon.textContent = 'ğŸŒ';
            }
        }
        
        // Helper function to safely get translation
        function getTranslation(key, fallback) {
            try {
                const result = window.translate ? window.translate(key) : fallback;
                return result || fallback;
            } catch (error) {
                console.log(`Translation error for key ${key}:`, error);
                return fallback;
            }
        }
        
        // Update status indicator
        function updateStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator status-${status}`;
            indicator.textContent = message;
        }
        
        // Initialize cameras
        async function initializeCameras() {
            try {
                const cameras = await QrScanner.listCameras(true);
                const cameraSelect = document.getElementById('cameraSelect');
                
                cameraSelect.innerHTML = '<option value="">ì¹´ë©”ë¼ ì„ íƒ</option>';
                
                if (cameras.length === 0) {
                    cameraSelect.innerHTML = '<option value="">ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</option>';
                    updateStatus('error', 'ì¹´ë©”ë¼ ì—†ìŒ');
                    return;
                }
                
                cameras.forEach((camera, index) => {
                    const option = document.createElement('option');
                    option.value = camera.id;
                    option.textContent = camera.label || `ì¹´ë©”ë¼ ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                // í›„ë©´ ì¹´ë©”ë¼ ìš°ì„  ì„ íƒ
                const backCamera = cameras.find(camera => 
                    camera.label.toLowerCase().includes('back') ||
                    camera.label.toLowerCase().includes('rear') ||
                    camera.label.toLowerCase().includes('environment')
                );
                
                // í›„ë©´ ì¹´ë©”ë¼ê°€ ì—†ìœ¼ë©´ ì „ë©´ ì¹´ë©”ë¼ ì°¾ê¸°
                const frontCamera = cameras.find(camera => 
                    camera.label.toLowerCase().includes('front') ||
                    camera.label.toLowerCase().includes('user') ||
                    camera.label.toLowerCase().includes('facetime')
                );
                
                if (backCamera) {
                    cameraSelect.value = backCamera.id;
                } else if (frontCamera) {
                    cameraSelect.value = frontCamera.id;
                } else if (cameras.length > 0) {
                    cameraSelect.value = cameras[0].id;
                }
                
                console.log('ì¹´ë©”ë¼ ì´ˆê¸°í™” ì™„ë£Œ:', cameras.length, 'ê°œ ë°œê²¬');
                updateStatus('ready', 'ì¤€ë¹„ë¨');
                
            } catch (error) {
                console.error('ì¹´ë©”ë¼ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateStatus('error', 'ì¹´ë©”ë¼ ì˜¤ë¥˜');
            }
        }
        
        // Generate QR code
        function generateQR() {
            console.log('QR ì½”ë“œ ìƒì„± ì‹œì‘');
            const qrText = document.getElementById("qrText").value.trim();
            if (!qrText) {
                alert('í…ìŠ¤íŠ¸ ë˜ëŠ” URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const qrcodeElement = document.getElementById("qrcode");
            qrcodeElement.innerHTML = "";

            new QRCode(qrcodeElement, {
                text: qrText,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.style.display = 'inline-block';
            downloadBtn.onclick = () => {
                console.log('ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­');
                const canvas = qrcodeElement.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'qrcode.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    console.log('QR ì½”ë“œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                } else {
                    console.error('Canvas ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            };
            
            console.log('QR ì½”ë“œ ìƒì„± ì™„ë£Œ');
        }
        
        // Handle QR scan result
        function handleScanResult(result) {
            console.log('QR ìŠ¤ìº” ê²°ê³¼:', result);
            
            // resultê°€ ê°ì²´ì¸ ê²½ìš° data ì†ì„±ì„ ì‚¬ìš©
            const resultText = typeof result === 'object' ? result.data : result;
            lastResult = resultText;
            
            // WiFi QR ì½”ë“œì¸ì§€ í™•ì¸
            if (resultText.startsWith('WIFI:')) {
                const wifiParams = parseWifiQR(resultText);
                if (wifiParams) {
                    // ëª¨ë°”ì¼ ê¸°ê¸°ì¸ ê²½ìš° WiFi ì—°ê²° ì‹œë„
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // Androidì˜ ê²½ìš°
                        if (/Android/i.test(navigator.userAgent)) {
                            const wifiString = `wifi://${wifiParams.ssid}/${wifiParams.password}/${wifiParams.encryption}`;
                            window.location.href = wifiString;
                        }
                        // iOSì˜ ê²½ìš°
                        else if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                            const wifiString = `WIFI:T:${wifiParams.encryption};S:${wifiParams.ssid};P:${wifiParams.password};;`;
                            window.location.href = `https://wifi-connect.apple.com/?ssid=${encodeURIComponent(wifiParams.ssid)}&password=${encodeURIComponent(wifiParams.password)}`;
                        }
                    }
                    
                    // ê²°ê³¼ í‘œì‹œ
                    document.getElementById('resultText').innerHTML = `
                        <div class="wifi-info">
                            <p><strong>ë„¤íŠ¸ì›Œí¬ ì´ë¦„:</strong> ${wifiParams.ssid}</p>
                            <p><strong>ì•”í˜¸í™” ë°©ì‹:</strong> ${wifiParams.encryption}</p>
                            <p><strong>ë¹„ë°€ë²ˆí˜¸:</strong> ${wifiParams.password || 'ì—†ìŒ'}</p>
                        </div>
                    `;
                    document.getElementById('scanResult').style.display = 'block';
                    document.getElementById('openBtn').style.display = 'none';
                }
            } else {
                // ì¼ë°˜ QR ì½”ë“œ ì²˜ë¦¬
                document.getElementById('resultText').textContent = resultText;
                document.getElementById('scanResult').style.display = 'block';
                
                // URLì¸ì§€ í™•ì¸
                try {
                    new URL(resultText);
                    document.getElementById('openBtn').style.display = 'inline-block';
                } catch {
                    document.getElementById('openBtn').style.display = 'none';
                }
            }
            
            // ì§„ë™ í”¼ë“œë°± (ì§€ì›ë˜ëŠ” ê²½ìš°)
            if ('vibrate' in navigator) {
                navigator.vibrate(200);
            }
            
            updateStatus('ready', 'ìŠ¤ìº” ì™„ë£Œ');
        }
        
        // WiFi QR ì½”ë“œ íŒŒì‹± í•¨ìˆ˜
        function parseWifiQR(qrString) {
            try {
                // WIFI:S:<SSID>;T:<WPA|WEP|>;P:<password>;;
                const params = {};
                const parts = qrString.substring(5).split(';');
                
                parts.forEach(part => {
                    if (part.startsWith('S:')) {
                        params.ssid = part.substring(2);
                    } else if (part.startsWith('T:')) {
                        params.encryption = part.substring(2);
                    } else if (part.startsWith('P:')) {
                        params.password = part.substring(2);
                    }
                });
                
                if (!params.ssid) return null;
                
                return {
                    ssid: params.ssid,
                    encryption: params.encryption || 'WPA',
                    password: params.password || ''
                };
            } catch (error) {
                console.error('WiFi QR íŒŒì‹± ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        // Toggle scanner
        async function toggleScanner() {
            const videoContainer = document.getElementById('video-container');
            const scanPlaceholder = document.getElementById('scan-placeholder');
            const video = document.getElementById('qr-video');
            const scanBtn = document.getElementById('scanBtn');
            const stopBtn = document.getElementById('stopBtn');
            const cameraSelect = document.getElementById('cameraSelect');
            
            if (scannerActive) {
                return;
            }
            
            const selectedCamera = cameraSelect.value;
            if (!selectedCamera) {
                alert('ì¹´ë©”ë¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            try {
                updateStatus('scanning', 'ì¹´ë©”ë¼ ì‹œì‘ ì¤‘...');
                
                // Hide placeholder, show video
                scanPlaceholder.style.display = 'none';
                videoContainer.style.display = 'block';
                
                // Create QR scanner
                qrScanner = new QrScanner(video, result => {
                    handleScanResult(result);
                }, {
                    returnDetailedScanResult: false,
                    highlightScanRegion: true,
                    highlightCodeOutline: true,
                    preferredCamera: selectedCamera,
                    maxScansPerSecond: 5
                });
                
                // Start scanner
                await qrScanner.start();
                
                scannerActive = true;
                scanBtn.style.display = 'none';
                stopBtn.style.display = 'block';
                
                updateStatus('scanning', 'ìŠ¤ìºë‹ ì¤‘...');
                console.log('QR ìŠ¤ìºë„ˆ ì‹œì‘ë¨');
                
            } catch (error) {
                console.error('ì¹´ë©”ë¼ ì‹œì‘ ì˜¤ë¥˜:', error);
                
                let errorMessage = 'ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¹´ë©”ë¼ê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•±ì—ì„œ ì¹´ë©”ë¼ë¥¼ ì‚¬ìš© ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                }
                
                alert(errorMessage);
                updateStatus('error', 'ì¹´ë©”ë¼ ì˜¤ë¥˜');
                
                // Reset UI
                videoContainer.style.display = 'none';
                scanPlaceholder.style.display = 'block';
            }
        }
        
        // Stop scanner
        function stopScanner() {
            if (qrScanner) {
                qrScanner.stop();
                qrScanner.destroy();
                qrScanner = null;
            }
            
            scannerActive = false;
            
            // Reset UI
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('scan-placeholder').style.display = 'block';
            document.getElementById('scanBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            
            updateStatus('ready', 'ì¤€ë¹„ë¨');
            console.log('QR ìŠ¤ìºë„ˆ ì¤‘ì§€ë¨');
        }
        
        // Copy result to clipboard
        function copyResult() {
            if (!lastResult) return;
            
            navigator.clipboard.writeText(lastResult).then(() => {
                const copyAlert = document.getElementById('copyAlert');
                copyAlert.style.display = 'block';
                setTimeout(() => copyAlert.style.display = 'none', 2000);
            }).catch(err => {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì˜¤ë¥˜:', err);
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        // Open result URL
        function openResult() {
            if (!lastResult) return;
            
            try {
                new URL(lastResult);
                window.open(lastResult, '_blank');
            } catch {
                alert('ìœ íš¨í•œ URLì´ ì•„ë‹™ë‹ˆë‹¤.');
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('QR Tool ì´ˆê¸°í™” ì‹œì‘');
            
            // Load theme
            loadTheme();
            
            // Initialize cameras
            await initializeCameras();
            
            // Initialize i18n
            try {
                if (window.initializeLocalization) {
                    await window.initializeLocalization();
                    console.log('ë‹¤êµ­ì–´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì„±ê³µ');
                }
            } catch (error) {
                console.error('ë‹¤êµ­ì–´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
            
            console.log('QR Tool ì´ˆê¸°í™” ì™„ë£Œ');
        });
        
        // Scan from uploaded image
        async function scanFromImage() {
            const fileInput = document.getElementById('qrImageUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            try {
                updateStatus('scanning', 'ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...');
                console.log('ì´ë¯¸ì§€ì—ì„œ QR ì½”ë“œ ìŠ¤ìº” ì‹œì‘:', file.name);
                
                const result = await QrScanner.scanImage(file);
                handleScanResult(result);
                
            } catch (error) {
                console.error('ì´ë¯¸ì§€ ìŠ¤ìº” ì˜¤ë¥˜:', error);
                updateStatus('error', 'QR ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                alert('ì´ë¯¸ì§€ì—ì„œ QR ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª…í™•í•˜ê³  ì„ ëª…í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // WiFi QR ì½”ë“œ ìƒì„± í•¨ìˆ˜
        function generateWifiQR() {
            const ssid = document.getElementById('ssid').value.trim();
            const password = document.getElementById('password').value.trim();
            const encryption = document.getElementById('encryption').value;
            
            if (!ssid) {
                alert('ë„¤íŠ¸ì›Œí¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            if (encryption !== 'nopass' && !password) {
                alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // WiFi QR ì½”ë“œ í˜•ì‹: WIFI:S:<SSID>;T:<WPA|WEP|>;P:<password>;;
            let wifiString = `WIFI:S:${ssid};T:${encryption};`;
            if (encryption !== 'nopass') {
                wifiString += `P:${password};`;
            }
            wifiString += ';';
            
            const wifiQrcodeElement = document.getElementById('wifiQrcode');
            wifiQrcodeElement.innerHTML = '';
            
            new QRCode(wifiQrcodeElement, {
                text: wifiString,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            const wifiDownloadBtn = document.getElementById('wifiDownloadBtn');
            wifiDownloadBtn.style.display = 'inline-block';
            wifiDownloadBtn.onclick = () => {
                const canvas = wifiQrcodeElement.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'wifi-qrcode.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            };
        }
        
        // Make functions globally available
        window.toggleTheme = toggleTheme;
        window.generateQR = generateQR;
        window.toggleScanner = toggleScanner;
        window.stopScanner = stopScanner;
        window.copyResult = copyResult;
        window.openResult = openResult;
        window.scanFromImage = scanFromImage;
        window.generateWifiQR = generateWifiQR;
    </script>
</body>
</html>
