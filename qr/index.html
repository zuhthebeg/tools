<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator and Scanner</title>
    <meta name="description" content="Generate and scan QR codes instantly. Supports URLs, text, contact info, and WiFi credentials. Works on all devices.">
    <meta name="keywords" content="QR code generator, QR code scanner, online QR tools, mobile QR generator">
    <meta name="author" content="cocy.io">
    <meta property="og:title" content="Online QR Code Generator and Scanner">
    <meta property="og:description" content="Free web-based QR code generation and scanning tool with real-time preview">
    <meta property="og:image" content="https://tool.cocy.io/qr/icon.svg">
    <meta property="og:url" content="https://tool.cocy.io/qr/">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Localization Script -->
    <script src="https://tool.cocy.io/localization.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KLF3L6R84V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KLF3L6R84V');
    </script>
    
    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script type="module" src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #121212 0%, #1a1a1a 100%);
            color: #f0f0f0;
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body.light-mode {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #212529;
        }
        
        .container {
            background: rgba(34, 34, 34, 0.95);
            border: 1px solid #333333;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            max-width: 800px;
            margin: 2rem auto;
            padding: 25px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        body.light-mode .container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e0e0e0;
            color: #212529;
        }
        
        .qr-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        body.dark-mode .qr-section {
            background: rgba(40, 40, 40, 0.95);
            color: #f0f0f0;
        }
        
        #qrcode {
            margin: 1.5rem auto;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 8px;
            padding: 10px;
        }
        
        body.dark-mode #qrcode {
            background: #f8f9fa;
        }
        
        #video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }
        
        #qr-video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .highlight-box {
            position: absolute;
            border: 2px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            display: none;
        }
        
        .btn-primary {
            background: #4285f4;
            border-color: #4285f4;
            font-weight: 500;
        }
        
        .btn-success {
            background: #34a853;
            border-color: #34a853;
            font-weight: 500;
        }
        
        .btn-danger {
            background: #ea4335;
            border-color: #ea4335;
            font-weight: 500;
        }
        
        .btn {
            border-radius: 8px;
            padding: 10px 16px;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .qr-section h2 {
            color: #333;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
            margin-bottom: 1rem;
            font-weight: 700;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        body.dark-mode .qr-section h2 {
            color: #f0f0f0;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }
        
        .alert {
            border-radius: 8px;
            font-weight: 500;
        }
        
        #scanResult {
            word-break: break-all;
        }
        
        .camera-controls {
            margin-bottom: 1rem;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-scanning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Î∞òÏùëÌòï Ïä§ÌÉÄÏùº */
        @media (max-width: 768px) {
            .container {
                margin: 1rem auto;
                padding: 15px;
                width: 95%;
            }
            .qr-section {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            .camera-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 12px;
                border-radius: 12px;
            }
            .qr-section {
                padding: 1.2rem;
            }
        }

        .nav-tabs {
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tabs .nav-link {
            color: #6c757d;
            border: 1px solid transparent;
            border-top-left-radius: 0.25rem;
            border-top-right-radius: 0.25rem;
            padding: 0.5rem 1rem;
            margin-bottom: -1px;
        }

        .nav-tabs .nav-link:hover {
            border-color: #e9ecef #e9ecef #dee2e6;
        }

        .nav-tabs .nav-link.active {
            color: #495057;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
        }

        body.dark-mode .nav-tabs .nav-link {
            color: #adb5bd;
        }

        body.dark-mode .nav-tabs .nav-link.active {
            color: #f8f9fa;
            background-color: #343a40;
            border-color: #495057 #495057 #343a40;
        }

        body.dark-mode .nav-tabs {
            border-bottom-color: #495057;
        }

        .wifi-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .wifi-info p {
            margin-bottom: 8px;
        }

        .wifi-info p:last-child {
            margin-bottom: 0;
        }

        body.dark-mode .wifi-info {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-center display-4 flex-grow-1" data-translate-key="qr_title">QR Code Generator and Scanner</h1>
            <button id="themeToggle" class="btn btn-outline-secondary" onclick="toggleTheme()">
                <span id="themeIcon">üåû</span>
            </button>
        </div>
        
        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Ï∂îÍ∞Ä -->
        <div class="nav nav-tabs mb-4" id="qrTabs" role="tablist">
            <button class="nav-link active" id="generate-tab" data-bs-toggle="tab" data-bs-target="#generate" type="button" role="tab">QR ÏÉùÏÑ±</button>
            <button class="nav-link" id="wifi-tab" data-bs-toggle="tab" data-bs-target="#wifi" type="button" role="tab">WiFi QR</button>
            <button class="nav-link" id="scan-tab" data-bs-toggle="tab" data-bs-target="#scan" type="button" role="tab">QR Ïä§Ï∫î</button>
        </div>

        <!-- ÌÉ≠ ÏΩòÌÖêÏ∏† -->
        <div class="tab-content" id="qrTabContent">
            <!-- QR ÏÉùÏÑ± ÌÉ≠ -->
            <div class="tab-pane fade show active" id="generate" role="tabpanel">
                <div class="qr-section">
                    <h2>QR ÏΩîÎìú ÏÉùÏÑ±</h2>
                    <div class="input-group mb-3">
                        <input type="text" id="qrText" class="form-control" placeholder="ÌÖçÏä§Ìä∏ ÎòêÎäî URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        <button onclick="generateQR()" class="btn btn-primary">ÏÉùÏÑ±ÌïòÍ∏∞</button>
                    </div>
                    <div id="qrcode"></div>
                    <div class="mt-3">
                        <button id="downloadBtn" class="btn btn-outline-primary" style="display:none;">QR ÏΩîÎìú Îã§Ïö¥Î°úÎìú</button>
                    </div>
                </div>
            </div>

            <!-- WiFi QR ÌÉ≠ -->
            <div class="tab-pane fade" id="wifi" role="tabpanel">
                <div class="qr-section">
                    <h2>WiFi QR ÏΩîÎìú ÏÉùÏÑ±</h2>
                    <form id="wifiForm" class="mb-3">
                        <div class="mb-3">
                            <label for="ssid" class="form-label">ÎÑ§Ìä∏ÏõåÌÅ¨ Ïù¥Î¶Ñ (SSID)</label>
                            <input type="text" class="form-control" id="ssid" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="encryption" class="form-label">ÏïîÌò∏Ìôî Î∞©Ïãù</label>
                            <select class="form-select" id="encryption">
                                <option value="WPA">WPA/WPA2</option>
                                <option value="WEP">WEP</option>
                                <option value="nopass">ÏïîÌò∏Ìôî ÏóÜÏùå</option>
                            </select>
                        </div>
                        <button type="button" onclick="generateWifiQR()" class="btn btn-primary">WiFi QR ÏÉùÏÑ±</button>
                    </form>
                    <div id="wifiQrcode"></div>
                    <div class="mt-3">
                        <button id="wifiDownloadBtn" class="btn btn-outline-primary" style="display:none;">WiFi QR Îã§Ïö¥Î°úÎìú</button>
                    </div>
                </div>
            </div>

            <!-- QR Ïä§Ï∫î ÌÉ≠ -->
            <div class="tab-pane fade" id="scan" role="tabpanel">
                <div class="qr-section">
                    <h2>QR ÏΩîÎìú Ïä§Ï∫î</h2>
                    <!-- Í∏∞Ï°¥ Ïä§Ï∫î Í¥ÄÎ†® ÏΩîÎìú Ïú†ÏßÄ -->
                    <div class="camera-controls">
                        <select id="cameraSelect" class="form-select flex-grow-1">
                            <option value="">Ïπ¥Î©îÎùº ÏÑ†ÌÉù</option>
                        </select>
                        <span id="statusIndicator" class="status-indicator status-ready">Ï§ÄÎπÑÎê®</span>
                    </div>
                    
                    <div class="mb-3">
                        <div class="mb-3">
                            <label for="qrImageUpload" class="form-label">üìÅ QR ÏΩîÎìú Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</label>
                            <input type="file" id="qrImageUpload" class="form-control" accept="image/*" onchange="scanFromImage()">
                        </div>
                        
                        <div id="video-container" style="display: none;">
                            <video id="qr-video" playsinline></video>
                            <div id="highlight-box" class="highlight-box"></div>
                        </div>
                        <div id="scan-placeholder" class="text-center p-5 bg-light rounded">
                            üì∑ Ïä§Ï∫î ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ïπ¥Î©îÎùºÎ•º ÌôúÏÑ±ÌôîÌïòÍ±∞ÎÇò ÏúÑÏóêÏÑú Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî
                        </div>
                    </div>
                    
                    <div id="scanResult" class="alert alert-info" style="display:none;">
                        <strong>Ïä§Ï∫î Í≤∞Í≥º:</strong> <span id="resultText"></span>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="copyResult()">üìã Î≥µÏÇ¨</button>
                            <button class="btn btn-sm btn-outline-success" onclick="openResult()" id="openBtn" style="display:none;">üåê Ïó¥Í∏∞</button>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button onclick="toggleScanner()" id="scanBtn" class="btn btn-success">üì∑ Ïä§Ï∫î ÏãúÏûë</button>
                        <button onclick="stopScanner()" id="stopBtn" class="btn btn-danger" style="display:none;">‚èπÔ∏è Ïä§Ï∫î Ï§ëÏßÄ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 mt-5">
        <div class="container">
            <p class="mb-1">Powered by <a href="https://cocy.io" target="_blank">cocy.io</a></p>
            <p class="small text-muted">Free QR Code Generator and Scanner Tool</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        import QrScanner from 'https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js';
        
        // Global variables
        let qrScanner = null;
        let scannerActive = false;
        let lastResult = '';
        
        // Set worker path
        QrScanner.WORKER_PATH = 'https://unpkg.com/qr-scanner@1.4.2/qr-scanner-worker.min.js';
        
        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeIcon.textContent = 'üåû';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'light') {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                themeIcon.textContent = 'üåô';
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeIcon.textContent = 'üåû';
            }
        }
        
        // Helper function to safely get translation
        function getTranslation(key, fallback) {
            try {
                const result = window.translate ? window.translate(key) : fallback;
                return result || fallback;
            } catch (error) {
                console.log(`Translation error for key ${key}:`, error);
                return fallback;
            }
        }
        
        // Update status indicator
        function updateStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator status-${status}`;
            indicator.textContent = message;
        }
        
        // Initialize cameras
        async function initializeCameras() {
            try {
                const cameras = await QrScanner.listCameras(true);
                const cameraSelect = document.getElementById('cameraSelect');
                
                cameraSelect.innerHTML = '<option value="">Ïπ¥Î©îÎùº ÏÑ†ÌÉù</option>';
                
                if (cameras.length === 0) {
                    cameraSelect.innerHTML = '<option value="">Ïπ¥Î©îÎùºÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</option>';
                    updateStatus('error', 'Ïπ¥Î©îÎùº ÏóÜÏùå');
                    return;
                }
                
                cameras.forEach((camera, index) => {
                    const option = document.createElement('option');
                    option.value = camera.id;
                    option.textContent = camera.label || `Ïπ¥Î©îÎùº ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                // ÌõÑÎ©¥ Ïπ¥Î©îÎùº Ïö∞ÏÑ† ÏÑ†ÌÉù
                const backCamera = cameras.find(camera => 
                    camera.label.toLowerCase().includes('back') ||
                    camera.label.toLowerCase().includes('rear') ||
                    camera.label.toLowerCase().includes('environment')
                );
                
                // ÌõÑÎ©¥ Ïπ¥Î©îÎùºÍ∞Ä ÏóÜÏúºÎ©¥ Ï†ÑÎ©¥ Ïπ¥Î©îÎùº Ï∞æÍ∏∞
                const frontCamera = cameras.find(camera => 
                    camera.label.toLowerCase().includes('front') ||
                    camera.label.toLowerCase().includes('user') ||
                    camera.label.toLowerCase().includes('facetime')
                );
                
                if (backCamera) {
                    cameraSelect.value = backCamera.id;
                } else if (frontCamera) {
                    cameraSelect.value = frontCamera.id;
                } else if (cameras.length > 0) {
                    cameraSelect.value = cameras[0].id;
                }
                
                console.log('Ïπ¥Î©îÎùº Ï¥àÍ∏∞Ìôî ÏôÑÎ£å:', cameras.length, 'Í∞ú Î∞úÍ≤¨');
                updateStatus('ready', 'Ï§ÄÎπÑÎê®');
                
            } catch (error) {
                console.error('Ïπ¥Î©îÎùº Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                updateStatus('error', 'Ïπ¥Î©îÎùº Ïò§Î•ò');
            }
        }
        
        // Generate QR code
        function generateQR() {
            console.log('QR ÏΩîÎìú ÏÉùÏÑ± ÏãúÏûë');
            const qrText = document.getElementById("qrText").value.trim();
            if (!qrText) {
                alert('ÌÖçÏä§Ìä∏ ÎòêÎäî URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            const qrcodeElement = document.getElementById("qrcode");
            qrcodeElement.innerHTML = "";

            new QRCode(qrcodeElement, {
                text: qrText,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.style.display = 'inline-block';
            downloadBtn.onclick = () => {
                console.log('Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌÅ¥Î¶≠');
                const canvas = qrcodeElement.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'qrcode.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    console.log('QR ÏΩîÎìú Îã§Ïö¥Î°úÎìú ÏôÑÎ£å');
                } else {
                    console.error('Canvas ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
            };
            
            console.log('QR ÏΩîÎìú ÏÉùÏÑ± ÏôÑÎ£å');
        }
        
        // Handle QR scan result
        function handleScanResult(result) {
            console.log('QR Ïä§Ï∫î Í≤∞Í≥º:', result);
            
            // resultÍ∞Ä Í∞ùÏ≤¥Ïù∏ Í≤ΩÏö∞ data ÏÜçÏÑ±ÏùÑ ÏÇ¨Ïö©
            const resultText = typeof result === 'object' ? result.data : result;
            lastResult = resultText;
            
            // WiFi QR ÏΩîÎìúÏù∏ÏßÄ ÌôïÏù∏
            if (resultText.startsWith('WIFI:')) {
                const wifiParams = parseWifiQR(resultText);
                if (wifiParams) {
                    // Î™®Î∞îÏùº Í∏∞Í∏∞Ïù∏ Í≤ΩÏö∞ WiFi Ïó∞Í≤∞ ÏãúÎèÑ
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // AndroidÏùò Í≤ΩÏö∞
                        if (/Android/i.test(navigator.userAgent)) {
                            const wifiString = `wifi://${wifiParams.ssid}/${wifiParams.password}/${wifiParams.encryption}`;
                            window.location.href = wifiString;
                        }
                        // iOSÏùò Í≤ΩÏö∞
                        else if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                            const wifiString = `WIFI:T:${wifiParams.encryption};S:${wifiParams.ssid};P:${wifiParams.password};;`;
                            window.location.href = `https://wifi-connect.apple.com/?ssid=${encodeURIComponent(wifiParams.ssid)}&password=${encodeURIComponent(wifiParams.password)}`;
                        }
                    }
                    
                    // Í≤∞Í≥º ÌëúÏãú
                    document.getElementById('resultText').innerHTML = `
                        <div class="wifi-info">
                            <p><strong>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïù¥Î¶Ñ:</strong> ${wifiParams.ssid}</p>
                            <p><strong>ÏïîÌò∏Ìôî Î∞©Ïãù:</strong> ${wifiParams.encryption}</p>
                            <p><strong>ÎπÑÎ∞ÄÎ≤àÌò∏:</strong> ${wifiParams.password || 'ÏóÜÏùå'}</p>
                        </div>
                    `;
                    document.getElementById('scanResult').style.display = 'block';
                    document.getElementById('openBtn').style.display = 'none';
                }
            } else {
                // ÏùºÎ∞ò QR ÏΩîÎìú Ï≤òÎ¶¨
                document.getElementById('resultText').textContent = resultText;
                document.getElementById('scanResult').style.display = 'block';
                
                // URLÏù∏ÏßÄ ÌôïÏù∏
                try {
                    new URL(resultText);
                    document.getElementById('openBtn').style.display = 'inline-block';
                } catch {
                    document.getElementById('openBtn').style.display = 'none';
                }
            }
            
            // ÏßÑÎèô ÌîºÎìúÎ∞± (ÏßÄÏõêÎêòÎäî Í≤ΩÏö∞)
            if ('vibrate' in navigator) {
                navigator.vibrate(200);
            }
            
            updateStatus('ready', 'Ïä§Ï∫î ÏôÑÎ£å');
        }
        
        // WiFi QR ÏΩîÎìú ÌååÏã± Ìï®Ïàò
        function parseWifiQR(qrString) {
            try {
                // WIFI:S:<SSID>;T:<WPA|WEP|>;P:<password>;;
                const params = {};
                const parts = qrString.substring(5).split(';');
                
                parts.forEach(part => {
                    if (part.startsWith('S:')) {
                        params.ssid = part.substring(2);
                    } else if (part.startsWith('T:')) {
                        params.encryption = part.substring(2);
                    } else if (part.startsWith('P:')) {
                        params.password = part.substring(2);
                    }
                });
                
                if (!params.ssid) return null;
                
                return {
                    ssid: params.ssid,
                    encryption: params.encryption || 'WPA',
                    password: params.password || ''
                };
            } catch (error) {
                console.error('WiFi QR ÌååÏã± Ïò§Î•ò:', error);
                return null;
            }
        }
        
        // Toggle scanner
        async function toggleScanner() {
            const videoContainer = document.getElementById('video-container');
            const scanPlaceholder = document.getElementById('scan-placeholder');
            const video = document.getElementById('qr-video');
            const scanBtn = document.getElementById('scanBtn');
            const stopBtn = document.getElementById('stopBtn');
            const cameraSelect = document.getElementById('cameraSelect');
            
            if (scannerActive) {
                return;
            }
            
            const selectedCamera = cameraSelect.value;
            if (!selectedCamera) {
                alert('Ïπ¥Î©îÎùºÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            try {
                updateStatus('scanning', 'Ïπ¥Î©îÎùº ÏãúÏûë Ï§ë...');
                
                // Hide placeholder, show video
                scanPlaceholder.style.display = 'none';
                videoContainer.style.display = 'block';
                
                // Create QR scanner
                qrScanner = new QrScanner(video, result => {
                    handleScanResult(result);
                }, {
                    returnDetailedScanResult: false,
                    highlightScanRegion: true,
                    highlightCodeOutline: true,
                    preferredCamera: selectedCamera,
                    maxScansPerSecond: 5
                });
                
                // Start scanner
                await qrScanner.start();
                
                scannerActive = true;
                scanBtn.style.display = 'none';
                stopBtn.style.display = 'block';
                
                updateStatus('scanning', 'Ïä§Ï∫êÎãù Ï§ë...');
                console.log('QR Ïä§Ï∫êÎÑà ÏãúÏûëÎê®');
                
            } catch (error) {
                console.error('Ïπ¥Î©îÎùº ÏãúÏûë Ïò§Î•ò:', error);
                
                let errorMessage = 'Ïπ¥Î©îÎùºÎ•º ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§.';
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'Ïπ¥Î©îÎùº Ï†ëÍ∑º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú Ïπ¥Î©îÎùº Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'Ïπ¥Î©îÎùºÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Ïπ¥Î©îÎùºÍ∞Ä Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'Ïπ¥Î©îÎùºÏóê Ï†ëÍ∑ºÌï† Ïàò ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Ïï±ÏóêÏÑú Ïπ¥Î©îÎùºÎ•º ÏÇ¨Ïö© Ï§ëÏùº Ïàò ÏûàÏäµÎãàÎã§.';
                }
                
                alert(errorMessage);
                updateStatus('error', 'Ïπ¥Î©îÎùº Ïò§Î•ò');
                
                // Reset UI
                videoContainer.style.display = 'none';
                scanPlaceholder.style.display = 'block';
            }
        }
        
        // Stop scanner
        function stopScanner() {
            if (qrScanner) {
                qrScanner.stop();
                qrScanner.destroy();
                qrScanner = null;
            }
            
            scannerActive = false;
            
            // Reset UI
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('scan-placeholder').style.display = 'block';
            document.getElementById('scanBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            
            updateStatus('ready', 'Ï§ÄÎπÑÎê®');
            console.log('QR Ïä§Ï∫êÎÑà Ï§ëÏßÄÎê®');
        }
        
        // Copy result to clipboard
        function copyResult() {
            if (!lastResult) return;
            
            navigator.clipboard.writeText(lastResult).then(() => {
                const copyAlert = document.getElementById('copyAlert');
                copyAlert.style.display = 'block';
                setTimeout(() => copyAlert.style.display = 'none', 2000);
            }).catch(err => {
                console.error('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïò§Î•ò:', err);
                alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            });
        }
        
        // Open result URL
        function openResult() {
            if (!lastResult) return;
            
            try {
                new URL(lastResult);
                window.open(lastResult, '_blank');
            } catch {
                alert('Ïú†Ìö®Ìïú URLÏù¥ ÏïÑÎãôÎãàÎã§.');
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('QR Tool Ï¥àÍ∏∞Ìôî ÏãúÏûë');
            
            // Load theme
            loadTheme();
            
            // Initialize cameras
            await initializeCameras();
            
            // Initialize i18n
            try {
                if (window.initializeLocalization) {
                    await window.initializeLocalization();
                    console.log('Îã§Íµ≠Ïñ¥ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏÑ±Í≥µ');
                }
            } catch (error) {
                console.error('Îã§Íµ≠Ïñ¥ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
            }
            
            console.log('QR Tool Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        });
        
        // Scan from uploaded image
        async function scanFromImage() {
            const fileInput = document.getElementById('qrImageUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            try {
                updateStatus('scanning', 'Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë...');
                console.log('Ïù¥ÎØ∏ÏßÄÏóêÏÑú QR ÏΩîÎìú Ïä§Ï∫î ÏãúÏûë:', file.name);
                
                const result = await QrScanner.scanImage(file);
                handleScanResult(result);
                
            } catch (error) {
                console.error('Ïù¥ÎØ∏ÏßÄ Ïä§Ï∫î Ïò§Î•ò:', error);
                updateStatus('error', 'QR ÏΩîÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                alert('Ïù¥ÎØ∏ÏßÄÏóêÏÑú QR ÏΩîÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Î™ÖÌôïÌïòÍ≥† ÏÑ†Î™ÖÌïú QR ÏΩîÎìú Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
            }
        }
        
        // WiFi QR ÏΩîÎìú ÏÉùÏÑ± Ìï®Ïàò
        function generateWifiQR() {
            const ssid = document.getElementById('ssid').value.trim();
            const password = document.getElementById('password').value.trim();
            const encryption = document.getElementById('encryption').value;
            
            if (!ssid) {
                alert('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (encryption !== 'nopass' && !password) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            // WiFi QR ÏΩîÎìú ÌòïÏãù: WIFI:S:<SSID>;T:<WPA|WEP|>;P:<password>;;
            let wifiString = `WIFI:S:${ssid};T:${encryption};`;
            if (encryption !== 'nopass') {
                wifiString += `P:${password};`;
            }
            wifiString += ';';
            
            const wifiQrcodeElement = document.getElementById('wifiQrcode');
            wifiQrcodeElement.innerHTML = '';
            
            new QRCode(wifiQrcodeElement, {
                text: wifiString,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            const wifiDownloadBtn = document.getElementById('wifiDownloadBtn');
            wifiDownloadBtn.style.display = 'inline-block';
            wifiDownloadBtn.onclick = () => {
                const canvas = wifiQrcodeElement.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'wifi-qrcode.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            };
        }
        
        // Make functions globally available
        window.toggleTheme = toggleTheme;
        window.generateQR = generateQR;
        window.toggleScanner = toggleScanner;
        window.stopScanner = stopScanner;
        window.copyResult = copyResult;
        window.openResult = openResult;
        window.scanFromImage = scanFromImage;
        window.generateWifiQR = generateWifiQR;
    </script>
</body>
</html>
