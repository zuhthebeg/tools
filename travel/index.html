<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>대만 여행 일정 (한/중)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
  :root{
    --accent:#2b7a78;
    --muted:#6b6b6b;
    --card:#ffffff;
    --bg:#f6f8f9;
    --shadow: 0 6px 18px rgba(34,34,34,0.08);
    --important: #e74c3c;
    font-family: "Noto Sans KR", "Noto Sans TC", Arial, sans-serif;
  }
  body{
    margin:0;
    background:var(--bg);
    color:#222;
    line-height:1.45;
    -webkit-font-smoothing:antialiased;
    padding:28px;
  }
  h1{
    margin:0 0 10px 0;
    font-size:20px;
    color:var(--accent);
  }
  p.lead{
    margin:0 0 22px 0;
    color:var(--muted);
    font-size:14px;
  }

  /* Grid container for days */
  .days {
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:18px;
  }

  @media (max-width:980px){
    .days{ grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width:640px){
    .days{ grid-template-columns: 1fr; padding-bottom:40px; }
  }

  .day-card{
    background:var(--card);
    border-radius:12px;
    padding:14px;
    box-shadow:var(--shadow);
    min-height: 150px;
    display:flex;
    flex-direction:column;
  }
  .day-head{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
  }
  .day-title{
    font-weight:700;
    font-size:15px;
  }
  .day-sub{
    font-size:12px;
    color:var(--muted);
  }

  /* timeline list */
  .timeline{
    list-style:none;
    padding:0;
    margin:6px 0 0 0;
    display:flex;
    flex-direction:column;
    gap:10px;
    flex:1;
    overflow:auto;
  }
  .item{
    position: relative;
    display:grid;
    grid-template-columns:78px 1fr;
    gap:10px;
    align-items:start;
    padding:8px;
    border-radius:8px;
    transition:background .12s ease, transform .12s ease;
    cursor: grab;
  }
  .item:hover{ transform: translateY(-2px); background: #fbfdff; }
  .item.highlight {
    background-color: #fffbe5;
  }
  .item.important .content {
      border-left: 3px solid var(--important);
  }

  .time{
    font-weight:700;
    font-size:13px;
    color:var(--accent);
  }
  .content{
    background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(250,250,250,0.8));
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #efefef;
  }
  .k{
    display:block;
    font-weight:600;
  }
  .c{
    display:block;
    color:var(--muted);
    font-size:13px;
    margin-top:4px;
  }
  .note{
    display:block;
    margin-top:6px;
    color:#a33;
    font-size:12px;
  }
  .item-link {
    display: block;
    margin-top: 4px;
    font-size: 12px;
    color: var(--accent);
    text-decoration: underline;
    cursor: pointer;
  }

  /* footer / metadata */
  .meta{
    margin-top:12px;
    font-size:12px;
    color:var(--muted);
  }

  .controls {
    display: flex;
    gap: 5px;
    margin-top: 10px;
  }

  .btn {
    background-color: var(--accent);
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
  }

  .btn-delete-x {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 20px;
    height: 20px;
    background-color: #eee;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #888;
    line-height: 1;
  }
  .btn-delete-x:hover {
      background-color: #ddd;
      color: #333;
  }

  .important-toggle {
      margin-top: 5px;
  }


  /* Pretty print when printing */
  @media print{
    body{ padding:6mm; background:#fff; }
    .day-card{ box-shadow:none; page-break-inside:avoid; }
  }
</style>
</head>
<body>
  <header>
    <h1>대만 여행 일정표 — 한·중 병기</h1>
    <p class="lead">기간: 11/13(목) ~ 11/16(일) — 시간대별로 보기 쉽게 정리했습니다. (한국어 / 中文)</p>
    <div class="controls">
        <button class="btn" onclick="exportData()">내보내기</button>
        <button class="btn" onclick="document.getElementById('import-file').click()">가져오기</button>
        <input type="file" id="import-file" style="display: none" onchange="importData(event)" accept=".json">
    </div>
  </header>

  <section class="days">
  </section>

  <footer style="margin-top:18px;">
    <div style="font-size:13px;color:var(--muted)">
      © 2025 cocy.io
    </div>
  </footer>

<script>
const initialData = {
  "d13": {
    "title": "11/13 (목)",
    "subTitle": "11月13日（週四）",
    "daySub": "출발일 / 出發日",
    "meta": "숙소: 台北市萬華區武昌街二段124號 (Airbnb)",
    "items": [
      { "time": "10:30", "k": "인천공항 T2 도착 / 仁川機場 T2 抵達", "c": "공항버스 예약 / 預約機場巴士", "link": "", "linkText": "", "important": false },
      { "time": "12:30", "k": "출발 / 出發", "c": "비행기 출발 시간 / 航班出發時間", "link": "", "linkText": "", "important": true },
      { "time": "14:20", "k": "타오위안 공항 T1 도착 / 桃園機場 T1 抵達", "c": "타이베이 이동 준비 / 準備前往台北", "link": "", "linkText": "", "important": true },
      { "time": "15:13–15:49", "k": "공항철도 → 타이베이역 (약 NT$160) / 機場捷運 → 台北車站（約NT$160）", "c": "교통카드 준비 / 準備交通卡", "link": "", "linkText": "", "important": false },
      { "time": "약 16:30", "k": "Airbnb 체크인 (萬華區 武昌街二段124號) / Airbnb 入住", "c": "주소: 台北市萬華區武昌街二段124號", "link": "", "linkText": "", "important": false },
      { "time": "18:00", "k": "사오보티쿤 / 小啵下班 (소규모 카페 또는 일정)", "c": "약 18:00 방문 예정 / 預計18:00", "link": "", "linkText": "", "important": false },
      { "time": "저녁", "k": "야시장 방문 / 享曼夜市", "c": "어디 야시장? 위치 미정 / 夜市地點未定", "note": "야시장 위치를 정하면 추가 업데이트 가능 / 若確定夜市地點可再更新", "link": "", "linkText": "", "important": false }
    ]
  },
  "d14": {
    "title": "11/14 (금)",
    "subTitle": "11月14日（週五）",
    "daySub": "스펀 & 지우펀 투어 / 十分 & 九份 郊遊",
    "items": [
      { "time": "오전", "k": "대만식 아침 (豆漿/蛋餅 등) / 台灣早餐", "c": "백종원 추천 가게 고려 / 推薦店家（백종원）", "link": "", "linkText": "", "important": false },
      { "time": "13:00", "k": "스펀 폭포 & 지우펀 투어 출발 / 十分瀑布 & 九份 一日遊 出發", "c": "B코스: 스펀 & 스펀 폭포 & 지우펀 옛거리 / 行程包括十分瀑布與九份老街", "link": "", "linkText": "", "important": false },
      { "time": "20:00", "k": "타이베이 복귀 / 返回台北", "c": "정상적으로 20:00경 완료 예정 / 預計約20:00結束", "link": "", "linkText": "", "important": false },
      { "time": "저녁", "k": "저녁식사: 熱炒 또는 현지 식당 / 熱炒餐廳", "c": "위치 미정 / 地點未定", "link": "", "linkText": "", "important": false }
    ]
  },
  "d15": {
    "title": "11/15 (토)",
    "subTitle": "11月15日（週六）",
    "daySub": "타이베이 시내 / 台北市內",
    "items": [
      { "time": "오전", "k": "대만식 아침: 豆漿蛋餅 / 台灣早餐", "c": "편안한 아침 / 輕鬆的早晨", "link": "", "linkText": "", "important": false },
      { "time": "오후", "k": "타이베이 101 방문 / 參觀 台北101", "c": "관광 및 쇼핑 / 觀光與購物", "link": "", "linkText": "", "important": false },
      { "time": "19:00", "k": "콘서트 관람 / 參加音樂會", "c": "티켓 및 장소 확인 필요 / 需確認門票與場地", "link": "", "linkText": "", "important": true },
      { "time": "저녁", "k": "야시장 / 마사지 선택 가능 / 夜市或按摩", "c": "마사지 예약 시 오후 시간 확인 / 若要按摩請確認時間", "link": "", "linkText": "", "important": false }
    ]
  },
  "d16": {
    "title": "11/16 (일)",
    "subTitle": "11月16日（週日）",
    "daySub": "귀국일 / 回程日",
    "meta": "체크아웃/체크인 시간: 체크아웃 11:00 전 권장 / 入住與退房時間請依Airbnb規定為主",
    "items": [
      { "time": "오전", "k": "늦잠, 여유로운 아침 / 睡晚一點，悠閒早餐", "c": "豆漿蛋餅 추천 / 推薦豆漿蛋餅", "link": "", "linkText": "", "important": false },
      { "time": "11:30–12:00", "k": "체크아웃 & 캐리어 보관 (로커) / 退房 & 寄放行李（置物櫃）", "c": "12:00까지 로커 또는 숙소에 보관 / 建議12:00前寄放", "link": "", "linkText": "", "important": false },
      { "time": "14:00 (권장)", "k": "마사지 (선택) / 按摩（可選）", "c": "오후 시간 권장 / 建議安排在下午", "link": "", "linkText": "", "important": false },
      { "time": "18:00", "k": "타오위안 공항 T1 도착 / 桃園機場 T1 抵達", "c": "공항 이동 시간 확보 / 建議預留足夠時間前往機場", "link": "", "linkText": "", "important": true },
      { "time": "20:00", "k": "출발 (귀국) / 出發（返回韓國）", "c": "비행기 출발 시간 확인 / 確認航班時間", "link": "", "linkText": "", "important": true }
    ]
  }
};

let travelData;

document.addEventListener('DOMContentLoaded', () => {
  loadData();
  renderSchedule();
  highlightCurrentTime();
  setInterval(highlightCurrentTime, 60000); // Check every minute
});

function loadData() {
  const savedData = localStorage.getItem('travelData');
  if (savedData) {
    travelData = JSON.parse(savedData);
  } else {
    travelData = initialData;
  }
}

function saveData() {
  localStorage.setItem('travelData', JSON.stringify(travelData));
}

function renderSchedule() {
    const daysContainer = document.querySelector('.days');
    daysContainer.innerHTML = '';

    for (const dayId in travelData) {
        const day = travelData[dayId];
        const dayCard = document.createElement('article');
        dayCard.className = 'day-card';
        dayCard.setAttribute('aria-labelledby', dayId);

        const dayHead = document.createElement('div');
        dayHead.className = 'day-head';
        dayHead.innerHTML = `
            <div>
                <div id="${dayId}" class="day-title">${day.title}</div>
                <div class="day-sub">${day.subTitle}</div>
            </div>
            <div class="day-sub">${day.daySub}</div>
        `;

        const timeline = document.createElement('ul');
        timeline.className = 'timeline';

        day.items.forEach((item, index) => {
            const itemEl = document.createElement('li');
            itemEl.className = `item ${item.important ? 'important' : ''}`;
            itemEl.dataset.dayId = dayId;
            itemEl.dataset.itemIndex = index;
            itemEl.innerHTML = `
                <button class="btn-delete-x" onclick="deleteItem('${dayId}', ${index})">×</button>
                <div class="time" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'time', this.innerText)">${item.time}</div>
                <div class="content">
                    <span class="k" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'k', this.innerText)">${item.k}</span>
                    <span class="c" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'c', this.innerText)">${item.c}</span>
                    ${item.note ? `<span class="note" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'note', this.innerText)">${item.note}</span>` : ''}
                    ${item.link ? `<a href="${item.link}" target="_blank" class="item-link" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'link', this.innerText)">${item.linkText || item.link}</a>` : `<span class="item-link" contenteditable="true" onblur="updateItem('${dayId}', ${index}, 'link', this.innerText)">링크 추가</span>`}
                    <div class="important-toggle">
                        <label><input type="checkbox" ${item.important ? 'checked' : ''} onchange="toggleImportant('${dayId}', ${index})"> 중요</label>
                    </div>
                </div>
            `;
            timeline.appendChild(itemEl);
        });

        const controls = document.createElement('div');
        controls.className = 'controls';
        controls.innerHTML = `<button class="btn" onclick="addItem('${dayId}')">일정 추가</button>`;

        dayCard.appendChild(dayHead);
        dayCard.appendChild(timeline);
        dayCard.appendChild(controls);

        if (day.meta) {
            const meta = document.createElement('div');
            meta.className = 'meta';
            meta.textContent = day.meta;
            dayCard.appendChild(meta);
        }

        daysContainer.appendChild(dayCard);

        new Sortable(timeline, {
            animation: 150,
            onEnd: function (evt) {
                const dayId = evt.item.dataset.dayId;
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                const item = travelData[dayId].items.splice(oldIndex, 1)[0];
                travelData[dayId].items.splice(newIndex, 0, item);
                saveData();
                renderSchedule(); // Re-render to update indices
            },
        });
    }
}

function updateItem(dayId, itemIndex, field, value) {
  const itemElement = document.querySelector(`.item[data-day-id='${dayId}'][data-item-index='${itemIndex}']`);
  const actualIndex = Array.from(itemElement.parentNode.children).indexOf(itemElement);

  if (field === 'link') {
    travelData[dayId].items[actualIndex]['link'] = value;
    travelData[dayId].items[actualIndex]['linkText'] = value;
  } else {
    travelData[dayId].items[actualIndex][field] = value;
  }
  saveData();
}

function addItem(dayId) {
  travelData[dayId].items.push({ time: "새 시간", k: "새 일정", c: "내용", link: "", linkText: "", important: false });
  saveData();
  renderSchedule();
}

function deleteItem(dayId, itemIndex) {
    const itemElement = document.querySelector(`.item[data-day-id='${dayId}'][data-item-index='${itemIndex}']`);
    const actualIndex = Array.from(itemElement.parentNode.children).indexOf(itemElement);

  if (confirm('이 일정을 삭제하시겠습니까?')) {
    travelData[dayId].items.splice(actualIndex, 1);
    saveData();
    renderSchedule();
  }
}

function toggleImportant(dayId, itemIndex) {
    const itemElement = document.querySelector(`.item[data-day-id='${dayId}'][data-item-index='${itemIndex}']`);
    const actualIndex = Array.from(itemElement.parentNode.children).indexOf(itemElement);
    travelData[dayId].items[actualIndex].important = !travelData[dayId].items[actualIndex].important;
    saveData();
    renderSchedule();
}

function highlightCurrentTime() {
  const now = new Date();
  const currentDay = now.getDate();
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();

  document.querySelectorAll('.item').forEach(item => {
    item.classList.remove('highlight');
  });

  const dayId = `d${13 + (currentDay - 13)}`;
  if (travelData[dayId]) {
    travelData[dayId].items.forEach((item, index) => {
      const timeParts = item.time.match(/(\d{2}):(\d{2})/);
      if (timeParts) {
        const hour = parseInt(timeParts[1], 10);
        const minute = parseInt(timeParts[2], 10);
        if (hour === currentHour && minute <= currentMinute && currentMinute < minute + 60) {
          const itemElement = document.querySelector(`.item[data-day-id="${dayId}"][data-item-index="${index}"]`);
          if (itemElement) {
            itemElement.classList.add('highlight');
          }
        }
      }
    });
  }
}

function exportData() {
    const dataStr = JSON.stringify(travelData, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

    const exportFileDefaultName = 'travel-data.json';

    let linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) {
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            travelData = importedData;
            saveData();
            renderSchedule();
        } catch (error) {
            alert('가져오기 실패: 유효하지 않은 JSON 파일입니다.');
        }
    };
    reader.readAsText(file);
}

</script>
</body>
</html>